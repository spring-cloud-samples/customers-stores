"use strict";angular.module("customersStoresUiApp",["ngAnimate","ngCookies","ngResource","ui.router","ngSanitize","ngTouch","google-maps"]).constant("appConfiguration",{customerApiUrl:window.location.protocol+"//"+window.location.host,storeApiUrl:window.location.protocol+"//"+window.location.host}).config(function(){}),angular.module("customersStoresUiApp").config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/customers"),a.state("customers",{url:"/customers",controller:"CustomerController",templateUrl:"views/customers.html"}).state("addCustomer",{url:"/customers/add",controller:"AddCustomerController",templateUrl:"views/add-customer.html"}).state("customerDetails",{url:"/customers/{customerId}",controller:"CustomerDetailsController",templateUrl:"views/customer-details.html"}).state("stores",{url:"/stores",controller:"StoreController",templateUrl:"views/stores.html"}).state("about",{url:"/about",templateUrl:"views/about.html"})}]),angular.module("customersStoresUiApp").controller("CustomerController",["$scope","$log","$http","$state","appConfiguration",function(a,b,c,d,e){a.addCustomer=function(){d.go("addCustomer")},a.viewCustomerDetails=function(a){b.info("Show details for customer with Id: "+a.id),d.go("customerDetails",{customerId:a.id})},a.deleteCustomer=function(d){b.info("Deleting customer with Id: "+d.id),c.delete(e.customerApiUrl+"/customers/"+d.id).then(function(){a.loadCustomers()})},a.loadCustomers=function(){var d=c.get(e.customerApiUrl+"/customers");d.then(function(c){b.info("Retrieved customers",c),c.data._embedded&&(a.customers=c.data._embedded.customers)})},a.loadCustomers()}]).controller("AddCustomerController",["$scope","$state","$log","$http","appConfiguration",function(a,b,c,d,e){a.map={center:{latitude:33.7489954,longitude:-84.3879824},zoom:12,events:{tilesloaded:function(a,b,d){c.log("Map has loaded: "+b,a,d)},click:function(b,d,e){c.log("user defined event: "+d,b,e);var f=e[0],g=f.latLng.lat(),h=f.latLng.lng();a.map.clickedMarker={id:0,title:"You clicked here lat: "+g+" lon: "+h,latitude:g,longitude:h},a.customer.address.location.latitude=g,a.customer.address.location.longitude=h,a.$apply()}}},a.customer={firstName:"",lastName:"",address:{location:{latitude:0,longitude:0}}},a.goBack=function(){b.go("customers")},a.geocodeAddress=function(){var b=new google.maps.Geocoder,d=[];a.customer.address.street&&d.push(a.customer.address.street),a.customer.address.city&&d.push(a.customer.address.city),a.customer.address.zipCode&&d.push(a.customer.address.zipCode),c.info("Geocoding address:",d.join(",")),b.geocode({address:d.join(",")},function(b,d){d===google.maps.GeocoderStatus.OK?(c.info("Found coordinates:",b[0].geometry.location),a.$apply(function(){a.customer.address.location.latitude=b[0].geometry.location.lat(),a.customer.address.location.longitude=b[0].geometry.location.lng()})):alert("Geocode was not successful for the following reason: "+d)})},a.reverseGeocodeCoordinates=function(){var b=new google.maps.Geocoder,d=parseFloat(a.customer.address.location.latitude),e=parseFloat(a.customer.address.location.longitude),f=new google.maps.LatLng(d,e);c.info("Reverse Geocoding:",f),b.geocode({latLng:f},function(b,d){if(d===google.maps.GeocoderStatus.OK){c.info("Found Address:",b[0]);var e="",f="",g="",h="";_(b[0].address_components).forEach(function(a){c.info("addressComponent",a),_.contains(a.types,"locality")&&(e=a.long_name),_.contains(a.types,"postal_code")&&(f=a.long_name),_.contains(a.types,"street_number")&&(g=a.long_name+" "),_.contains(a.types,"route")&&(h=a.long_name)}),a.$apply(function(){a.customer.address.city=e,a.customer.address.zipCode=f,a.customer.address.street=g+h})}else alert("Reverse Geocode was not successful for the following reason: "+d)})},a.getMyLocation=function(){c.info("Retrieving Location Information"),navigator.geolocation.getCurrentPosition(function(b){c.info("Location data retrieved",b);var d=b.coords;a.$apply(function(){a.customer.address.location.latitude=d.latitude,a.customer.address.location.longitude=d.longitude})})},a.submitCustomer=function(){c.info("Adding New Customer",a.customer);var f=d.post(e.customerApiUrl+"/customers",a.customer);f.then(function(a){c.info(a),b.go("customers")})},a.$watch("customer.address.location",function(){a.customer.address.location.latitude&&a.customer.address.location.longitude&&(a.map.center.latitude=a.customer.address.location.latitude,a.map.center.longitude=a.customer.address.location.longitude)},!0)}]).controller("CustomerDetailsController",["$scope","$state","$stateParams","$http","$log","appConfiguration",function(a,b,c,d,e,f){var g=c.customerId,h=d.get(f.customerApiUrl+"/customers/"+g);a.customer={firstName:"",lastName:"",address:{location:{latitude:0,longitude:0}}},h.then(function(b){e.info(b),a.customer=b.data,a.map={center:{latitude:a.customer.address.location.latitude,longitude:a.customer.address.location.longitude},zoom:12},e.info("Map Data",a.Map),a.findStoresNearby(a.customer._links["stores-nearby"].href)}),a.goBack=function(){b.go("customers")},a.findStoresNearby=function(b){if(b){e.info("Which Starbucks location are close to",b);var c=d.get(b);c.then(function(b){e.info("Nearby locations",b),b.data._embedded&&(a.stores=b.data._embedded.stores,_(a.stores).forEach(function(a){var b=a.address.location.y,c=a.address.location.x;a.latitude=b,a.longitude=c,a.icon="starbucks_logo.png"})),e.info("Nearby locations2",b)})}},a.map={center:{latitude:45,longitude:-73},zoom:12}}]),angular.module("customersStoresUiApp").controller("StoreController",["$scope","$log","$http","$state","appConfiguration",function(a,b,c,d,e){a.loadStores=function(){var d=c.get(e.storeApiUrl+"/stores");d.then(function(c){b.info("Retrieved stores",c),c.data._embedded&&(a.stores=c.data._embedded.stores)})},a.loadStores()}]),angular.module("customersStoresUiApp").controller("AboutController",["$scope",function(a){a.awesomeThings=["Spring"]}]);